{% autoescape 'tex' %}
\documentclass[a4paper]{book}
\usepackage{url}

\title{ {{page.metadata.title}} }
\author{ Sam Wilson }
\date{ {{ page.metadata.year }} }

\begin{document}
    \maketitle

    {% for p in database.query('SELECT * FROM pages WHERE
        date IS NOT NULL
        AND date >= "'~page.metadata.year~'-01-01 00:00:00"
        AND date < "'~page.metadata.year~'-12-31 24:00:00"
        ').fetchAll() %}

        \section{ {{ p.title}} }

        {% if p.tags is defined %}
            Tags:
            {% for t in p.tags %}
                {% set tag = database.query('SELECT * FROM pages WHERE id = "/tags/'~t~'"').fetch() %}
                -- {{ tag.title }}
            {%  endfor %}
            --
        {% endif %}

    \url{ https://samwilson.id.au{{ p.id}}.html }

         %}{ p.body|md2latex|raw }}

    {% endfor %}

\end{document}
{% endautoescape %}